<!DOCTYPE html>
<html lang="en">
<head>
          <!--Import Google Icon Font-->
          <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
          <!--Import materialize.css-->
          <link type="text/css" rel="stylesheet" href="../css/materialize.min.css"  media="screen,projection"/>
    
          <!--Let browser know website is optimized for mobile-->
          <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

          <style>
              .centered{
                position: absolute;
                top:50%;
                left:50%;
                margin-left:-110px;
                margin-top:-20px;
            }
            .float{
                position: fixed;
                bottom:10%;
                right:10%;
                margin-right:15px;
                margin-top:50px;
            }
          </style>
</head>
<body>
    <nav class="nav-wrapper teal">
        <a href="#" class="brand-logo center">Shopping List</a>
    </nav>
    
    <div class="container">
        <table class="highlight">
            <thead>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>

    <div class="centered" id="placeholder">
    </div>

    <div class="float">
        <button onclick=addItems() id="add" class="btn-floating btn-large waves-effect waves-light teal z-depth-4"><i class="material-icons">add</i></button>
    </div>
    

    <script>
        const electron = require('electron');
        const {ipcRenderer} = electron;
        const fs = require("fs");
        const path = require('path')

        let thead = document.querySelector('thead');
        let tbody = document.querySelector('tbody');
        let addbutton = document.querySelector('button');

        ipcRenderer.on('add:item',main);
        ipcRenderer.on('clear:item', clearItems);

        let dataPath = "./data/itemlist.json"
        const  addItems = (e) => ipcRenderer.send('add:page')

        main();

        function main(){
            fs.readFile(dataPath,'utf-8', (err, data) =>{
                if(err) throw err;
                data = JSON.parse(data)
                if (data.length >= 1){
                    if (thead.children.length <= 0){
                        let tr = document.createElement('tr');
                        ["Items", "Prices($)"].forEach((value,i) => {
                            let text = document.createTextNode(value)
                            let th   = document.createElement('th')
                            th.appendChild(text)
                            tr.appendChild(th)
                        })
                        thead.appendChild(tr)
                    }
    
                    let currItem;
                    for (var i = 0; i < data.length; i++){
                        currItem = data[i]
                        let tr = document.createElement('tr');
                        
                        ["item", "price"].forEach((value,i) => {
                            let text = document.createTextNode(currItem[value])
                            let td   = document.createElement('td')
                            td.appendChild(text)
                            tr.appendChild(td)
                        })
                        tr.addEventListener('dblclick', removeItem)
                        tbody.appendChild(tr)
                    }
                }
                else{
                    let placeholder = document.querySelector('#placeholder');
                    placeholder.appendChild(document.createTextNode("Click the + button to add new item."))
                }
                
            })
        }


        function removeItem(e){
            console.log(e)
            e.path[1].remove()
        }

        function clearItems(e){
            list.innerHTML = ""
            list.className = ""
        }

        function appendList(e, item){
           
        }

    </script>
    <script type="text/javascript" src="../js/materialize.min.js"></script>
</body>
</html>